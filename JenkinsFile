pipeline{
    agent any
   
    stages{
        stage('Build'){
            steps{
                echo "Code fetched from https://github.com/477Hashini/JenkinsIntegration.git/"
                echo "Bulding Initiated using Maven"
                echo "Build succesfully"
            }
        }

        stage('Unit and Integration Tests'){
            steps{
                echo "Unit tests Initiated with NUint"
                echo "Unit tests completed."
                echo "Intergration tests started with Selenium"
                echo "Intergration tests completed."
            }
    post {
        success {
            script {
                def emailBody = ""
                currentBuild.rawBuild.getLog(1000).each { line ->
                    emailBody += line + '\n'
                }
                mail to: "harshitbal80@gmail.com",
                     subject: "Build Successful: ${currentBuild.fullDisplayName}",
                     body: "The build was successful.\n\nLogs:\n\n$emailBody"
            }
        }
        failure {
            script {
                def emailBody = ""
                currentBuild.rawBuild.getLog(1000).each { line ->
                    emailBody += line + '\n'
                }
                mail to: "harshitbal80@gmail.com",
                     subject: "Build Failed: ${currentBuild.fullDisplayName}",
                     body: "The build has failed. Please check the logs for details.\n\nLogs:\n\n$emailBody"
            }
        }
    }
}

        

        stage('Code Analysis'){
            steps{
                echo "Code analysis started with Veracode"
                echo "Code analysis succesfully completed"
            }
        }

        stage('Security Scan'){
            steps{
                echo "Security scans started with 42Crunch"
                echo "Security scans succesfully completed"
            }
            post {
              success {
                    archiveArtifacts artifacts: '*/target/.log', allowEmptyArchive: true
                    emailext subject: "Build Successful: ${currentBuild.fullDisplayName}",
                              body: "The build was successful.",
                              attachmentsPattern: '*/target/.log',
                              to: 'harshitbal80@gmail.com'
            }
        }
}

        stage('Deploy to Staging'){
            steps{
                echo "Stagging deployment started"
                echo "Deployed to AWS EC2 instance-id: i-4214535890abcdef0 staging server"
            }
        }

        stage('Integration Tests on Staging'){
            steps{
                echo "Intergration tests started with Selenium"
                echo "Intergration tests completed succesfully."
            }
        }

        stage('Deploy to Production') {
            steps {
                echo "Stagging deployment started"
                echo "Deployed to AWS EC2 instance-i-4214535890abcdef0 staging server"
            }
        }
    }
}
